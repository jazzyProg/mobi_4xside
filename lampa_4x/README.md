# Signaling Service

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∏–≥–Ω–∞–ª—å–Ω—ã–º–∏ –ª–∞–º–ø–∞–º–∏ —á–µ—Ä–µ–∑ Modbus TCP.

## üöÄ –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã

### 1. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `.env.example` –≤ `.env` –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –≤–∞—à–µ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞.

```bash
cp .env.example .env
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r requirements.txt
```

### 3. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞

```bash
uvicorn app.main:app --host 0.0.0.0 --port 8002
```

### 4. –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
pytest tests/
```

### 5. –°–±–æ—Ä–∫–∞ Docker-–æ–±—Ä–∞–∑–∞

```bash
docker build -t lampa_4x .
```

### 6. –ó–∞–ø—É—Å–∫ –≤ Docker

```bash
docker run --rm -p 8002:8002 --env-file .env lampa_4x
```

## üì° API Endpoint'—ã

### Health Check
- `GET /health` - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞

### –°–∏–≥–Ω–∞–ª—ã
- `POST /signal/success` - –°–∏–≥–Ω–∞–ª —É—Å–ø–µ—à–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
- `POST /signal/fail` - –°–∏–≥–Ω–∞–ª –æ –±—Ä–∞–∫–µ
- `POST /signal/alarm` - –°–∏–≥–Ω–∞–ª –æ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–º –±—Ä–∞–∫–µ
- `POST /signal/heartbeat` - –°–∏–≥–Ω–∞–ª heartbeat
- `POST /signal/camera-trigger` - –°–∏–≥–Ω–∞–ª —Å—Ç–∞—Ä—Ç–∞ —Å—ä–µ–º–∫–∏ –∫–∞–º–µ—Ä—ã

## üõ†Ô∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤ —Ñ–∞–π–ª–µ `.env`:

- `MODBUS_IP` - IP –∞–¥—Ä–µ—Å Modbus —Å–µ—Ä–≤–µ—Ä–∞
- `MODBUS_PORT` - –ü–æ—Ä—Ç Modbus —Å–µ—Ä–≤–µ—Ä–∞
- `MODBUS_SLAVE_ID` - ID Modbus —Å–ª—ç–π–≤–∞
- `MODBUS_TIMEOUT_SEC` - –¢–∞–π–º–∞—É—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å Modbus
- `MODBUS_CONNECT_TIMEOUT_SEC` - –¢–∞–π–º–∞—É—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Modbus (async wrapper)
- `MODBUS_RETRIES` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π Modbus
- `MODBUS_RETRY_DELAY_SEC` - –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏ Modbus –æ–ø–µ—Ä–∞—Ü–∏–π
- `BIT_SUCCESS` - –ë–∏—Ç –¥–ª—è —Å–∏–≥–Ω–∞–ª–∞ —É—Å–ø–µ—à–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
- `BIT_FAIL` - –ë–∏—Ç –¥–ª—è —Å–∏–≥–Ω–∞–ª–∞ –æ –±—Ä–∞–∫–µ
- `BIT_ALARM` - –ë–∏—Ç –¥–ª—è —Å–∏–≥–Ω–∞–ª–∞ –æ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–º –±—Ä–∞–∫–µ
- `BIT_HEARTBEAT` - –ë–∏—Ç –¥–ª—è —Å–∏–≥–Ω–∞–ª–∞ heartbeat
- `BIT_CAMERA_TRIGGER` - –ë–∏—Ç –¥–ª—è —Å–∏–≥–Ω–∞–ª–∞ —Å—Ç–∞—Ä—Ç–∞ —Å—ä–µ–º–∫–∏ –∫–∞–º–µ—Ä—ã
- `PULSE_DURATION_SEC` - –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–º–ø—É–ª—å—Å–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- `CAMERA_TRIGGER_DURATION_SEC` - –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–º–ø—É–ª—å—Å–∞ camera-trigger –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- `HOST` - –•–æ—Å—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ API
- `PORT` - –ü–æ—Ä—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ API
- `LOG_LEVEL` - –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- `STRICT_STARTUP` - –†–µ–∂–∏–º —Å—Ç—Ä–æ–≥–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ (true/false)
- `API_PREFIX` - –ü—Ä–µ—Ñ–∏–∫—Å API endpoint'–æ–≤
- `SHUTDOWN_CLEAR_BITS` - –û—á–∏—â–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–µ –±–∏—Ç—ã –ø—Ä–∏ graceful shutdown